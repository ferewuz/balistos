

$(document).click(function(){$('#response').hide();});$(document).on("click","#response",function(event){event.stopPropagation();});function showResponse(response){$("#response").html("");$.each(response.items,function(index,value){$("#response").append("<li data-title='"+value.snippet.title+"' data-image='"+value.snippet.thumbnails.default.url+"' title='Add "+value.snippet.title+" to playlist' data-bind='click: addVideo' data-id='"+value.id.videoId+"' id='video-"+value.id.videoId+"'><img src='"+value.snippet.thumbnails.default.url+"'><div class='title'>"+value.snippet.title+"</div></li>");ko.applyBindings(playlist,$("#video-"+value.id.videoId)[0]);});$("#response").show();}
function onClientLoad(){gapi.client.load('youtube','v3',onYouTubeApiLoad);}
function onYouTubeApiLoad(){gapi.client.setApiKey('AIzaSyCnR3Vv-Erxjaa-IJapIXCnvgTOuXLXItA');}
function search(query){var request=gapi.client.youtube.search.list({part:'snippet',q:query,type:'video',maxResults:20,format:5,videoEmbeddable:true,key:'AIzaSyCnR3Vv-Erxjaa-IJapIXCnvgTOuXLXItA'});request.execute(showResponse);}
var tag=document.createElement('script');tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName('script')[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var player;function onYouTubeIframeAPIReady(){$("#search").keyup(function(e){ if($(this).val()===""){$("#response").hide();}
else{ var code=(e.keyCode?e.keyCode:e.which);var idx;if(code==40){if($("#response").children("li.active").length<1){$("#response").children("li:first-child").addClass("active");}
else{idx=$("#response").children("li.active").index()+1;$("#response").children().removeClass("active");if(idx>19){idx=0;$(".autocomplete").scrollTop(0);}
if(idx>9){$(".autocomplete").scrollTop(((parseInt(idx)-9)*42));}
$("#response").children().eq(idx).addClass("active");}}
else if(code==38){if($("#response").children("li.active").length<1){$("#response").children().eq(19).addClass("active");$(".autocomplete").scrollTop(420);}
else{idx=$("#response").children("li.active").index()-1;$("#response").children().removeClass("active");if(idx<0){idx=19;$(".autocomplete").scrollTop(420);}
if(idx<10){$(".autocomplete").scrollTop(((parseInt(idx))*42));}
$("#response").children().eq(idx).addClass("active");}}
else if(code==13){if($("#response").children("li.active").length>0){$("#response").children("li.active").trigger("click");}}
else{delaySearch($(this).val());}}});$(document).on("click",".overlay.play",function(){player.playVideo();$(".overlay").removeClass("play").addClass("pause");});$(document).on("click",".overlay.pause",function(){player.pauseVideo();$(".overlay").removeClass("pause").addClass("play");});$(document).on("click",".overlay.mute",function(){player.mute();$(".overlay").removeClass("mute").addClass("unmute");});$(document).on("click",".overlay.unmute",function(){player.unMute();$(".overlay").removeClass("unmute").addClass("mute");});$("#video-id").bind("DOMSubtreeModified",function(){if($(this).text()!==""){if(player){player.loadVideoById(playlist.firstVideoId(),0,"large");}
else{initPlayer();}}});initPlayer();}
function initPlayer(){if(playlist.firstVideoId()){player=new YT.Player("player",{height:"390",width:"640",videoId:playlist.firstVideoId(),playerVars:{controls:0,showinfo:0,start:parseInt(playlist.firstVideoStart()),disablekb:1,iv_load_policy:3,wmode:"transparent",rel:0},events:{"onReady":onPlayerReady}});}
else{$("#player").text("No video currently in the queue.");setTimeout(initPlayer(),500);}}
function updateProgress(){var percent=player.getCurrentTime()/player.getDuration()*100;$(".progress-bar").width(percent+"%").text(convertToTime(player.getCurrentTime())+" / "+convertToTime(player.getDuration()));setTimeout(updateProgress,1000);}
function convertToTime(seconds){var minutes=parseInt(seconds/60);seconds=parseInt(seconds%60);if(seconds<10)
seconds="0"+seconds;return minutes+":"+seconds;}
function onPlayerReady(event){event.target.playVideo();updateProgress();}
var typingTimer;var doneTypingInterval=300;function delaySearch(query){clearTimeout(typingTimer);typingTimer=setTimeout(function(){search(query);},doneTypingInterval);return true;}